(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621,694],{3254:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>y});var s=t(5155),a=t(2115),o=t(63),c=t(6900),n=t(1171),i=t(8902),l=t(7919),d=t(3405),m=t(8519),u=t(7816),g=t(7621),h=t(5536);function p(){let e=(0,o.useSearchParams)(),r=(0,o.useRouter)(),t=(0,h.h)(),p=e.get("token"),[y,x]=(0,a.useState)(!1),b=async()=>{if(p){x(!0);try{await g.cN.confirmWebpay(p),r.push("/checkout/confirm?token=".concat(p))}catch(e){console.error("Error al aprobar pago:",e),t.showError("Error al procesar el pago. Por favor, intenta nuevamente."),x(!1)}}};return(0,s.jsx)(c.U,{children:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,s.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,s.jsx)("div",{className:"max-w-md mx-auto",children:(0,s.jsxs)(d.Z,{className:"p-6 sm:p-8",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary-100 rounded-full flex items-center justify-center",children:(0,s.jsx)(m.A,{className:"w-8 h-8 text-primary-600"})}),(0,s.jsx)(n.D,{level:1,className:"mb-2",children:"Simulaci\xf3n de Webpay"}),(0,s.jsx)(i.E,{className:"text-gray-600 text-sm",children:"Esta es una simulaci\xf3n del proceso de pago. En producci\xf3n, ser\xedas redirigido a Webpay Transbank."})]}),(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,s.jsxs)(i.E,{className:"text-sm text-yellow-800",children:["⚠️ ",(0,s.jsx)("strong",{children:"Modo de prueba:"})," Este es un entorno simulado. En producci\xf3n, el pago se procesar\xeda a trav\xe9s de Webpay Transbank."]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(l.$,{className:"w-full",onClick:b,disabled:y,children:y?"Procesando...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"w-5 h-5 mr-2"}),"Aprobar pago (Simulaci\xf3n)"]})}),(0,s.jsx)(l.$,{variant:"ghost",className:"w-full",onClick:()=>{r.push("/checkout/confirm?token=rejected")},disabled:y,children:"Rechazar pago (Simulaci\xf3n)"})]}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,s.jsxs)(i.E,{className:"text-xs text-gray-500 text-center",children:["Token: ",null==p?void 0:p.substring(0,20),"..."]})})]})})})})})}function y(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(c.U,{children:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,s.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto mb-6"}),(0,s.jsx)(n.D,{level:1,className:"mb-4",children:"Cargando..."})]})})})}),children:(0,s.jsx)(p,{})})}},4444:(e,r,t)=>{Promise.resolve().then(t.bind(t,3254))},7621:(e,r,t)=>{"use strict";t.d(r,{ZN:()=>c,Zx:()=>n,cN:()=>i,customersApi:()=>l});let s=t(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3004";class a{async request(e,r,t){let s="".concat(this.baseUrl).concat(e),a=localStorage.getItem("customer_token");try{let e=await fetch(s,{...r,headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...t,...null==r?void 0:r.headers}});if(!e.ok){let r=await e.json().catch(()=>({message:"Error HTTP: ".concat(e.status," ").concat(e.statusText)})),t=r.message||r.error||"Error HTTP: ".concat(e.status);409===e.status?t=r.message||"Este email ya est\xe1 registrado. Por favor, inicia sesi\xf3n o usa otro email.":401===e.status?t=r.message||"Credenciales inv\xe1lidas. Verifica tu email y contrase\xf1a.":400===e.status?t=r.message||r.error||"Datos inv\xe1lidos. Por favor, verifica la informaci\xf3n ingresada.":404===e.status?t=r.message||"Recurso no encontrado.":e.status>=500&&(t="Error del servidor. Por favor, intenta m\xe1s tarde.");let s=Error(t);throw s.status=e.status,s.error=r,s}return e.json()}catch(e){if(e instanceof Error)throw e;throw Error("Error de red al conectar con el servidor")}}async get(e,r){return this.request(e,{method:"GET"},r)}async post(e,r,t){return this.request(e,{method:"POST",body:JSON.stringify(r)},t)}async patch(e,r){return this.request(e,{method:"PATCH",body:JSON.stringify(r)})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e){this.baseUrl=e}}let o=new a(s),c={getAll:()=>o.get("/products?isActive=true"),getFeatured:()=>o.get("/products/featured"),getById:e=>o.get("/products/".concat(e)),getBySlug:e=>o.get("/products/slug/".concat(e)),getByCategory:e=>o.get("/products?categoryId=".concat(e,"&isActive=true"))},n={getAll:()=>o.get("/categories"),getById:e=>o.get("/categories/".concat(e)),getBySlug:e=>o.get("/categories/slug/".concat(e))},i={create:e=>o.post("/orders",e),getMyOrders:()=>{let e=localStorage.getItem("customer_token");return o.get("/orders/my-orders",e?{Authorization:"Bearer ".concat(e)}:{})},getById:e=>o.get("/orders/".concat(e)),getShippingTypes:()=>o.get("/orders/shipping/types"),initiateWebpay:e=>o.post("/orders/".concat(e,"/webpay/init")),confirmWebpay:e=>o.post("/orders/webpay/confirm",{token:e})},l={register:e=>o.post("/customers/register",e),login:e=>o.post("/customers/login",e),getProfile:()=>{let e=localStorage.getItem("customer_token");return o.get("/customers/me",e?{Authorization:"Bearer ".concat(e)}:{})}}},8519:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});let s=(0,t(5105).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])}},e=>{e.O(0,[134,690,441,255,358],()=>e(e.s=4444)),_N_E=e.O()}]);