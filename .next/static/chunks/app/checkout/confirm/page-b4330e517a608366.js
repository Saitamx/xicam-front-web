(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[432,621],{952:(e,r,s)=>{"use strict";s.d(r,{A:()=>t});let t=(0,s(5105).A)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]])},2624:(e,r,s)=>{Promise.resolve().then(s.bind(s,7180))},7180:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>j});var t=s(5155),a=s(2115),o=s(63),c=s(6900),n=s(1165),i=s(1171),l=s(8902),d=s(7919),m=s(3405),u=s(1016),h=s(7816),x=s(952),g=s(2619),p=s.n(g),y=s(7621);function f(){let e,r=(0,o.useSearchParams)();(0,o.useRouter)();let{clearCart:s}=(0,n._)(),[g,f]=(0,a.useState)("loading"),[j,v]=(0,a.useState)(null),[N,b]=(0,a.useState)("");return((0,a.useEffect)(()=>{let e=r.get("token");if(!e||"rejected"===e){f("error"),b("Pago rechazado o cancelado");return}(async()=>{try{let r=await y.cN.confirmWebpay(e);v(r),f("success"),s()}catch(e){console.error("Error al confirmar pago:",e),f("error"),b(e.message||"Error al confirmar el pago")}})()},[r,s]),"loading"===g)?(0,t.jsx)(c.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto mb-6"}),(0,t.jsx)(i.D,{level:1,className:"mb-4",children:"Confirmando pago..."}),(0,t.jsx)(l.E,{className:"text-gray-600",children:"Por favor espera mientras procesamos tu pago"})]})})})}):"error"===g?(0,t.jsx)(c.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-6 bg-red-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(u.A,{className:"w-10 h-10 text-red-600"})}),(0,t.jsx)(i.D,{level:1,className:"mb-4 text-red-600",children:"Pago rechazado"}),(0,t.jsx)(l.E,{className:"text-gray-600 mb-8",children:N||"Hubo un problema al procesar tu pago. Por favor, intenta nuevamente."}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,t.jsx)(p(),{href:"/cart",children:(0,t.jsx)(d.$,{children:"Volver al carrito"})}),(0,t.jsx)(p(),{href:"/productos",children:(0,t.jsx)(d.$,{variant:"ghost",children:"Continuar comprando"})})]})]})})})}):(0,t.jsx)(c.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,t.jsx)("div",{className:"max-w-2xl mx-auto",children:(0,t.jsxs)(m.Z,{className:"p-6 sm:p-8 text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 mx-auto mb-6 bg-green-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(h.A,{className:"w-12 h-12 text-green-600"})}),(0,t.jsx)(i.D,{level:1,className:"mb-4 text-green-600",children:"\xa1Pago exitoso!"}),(0,t.jsxs)(l.E,{className:"text-gray-600 mb-6",children:["Tu orden ha sido procesada correctamente. Te hemos enviado un correo de confirmaci\xf3n a"," ",(0,t.jsx)("span",{className:"font-semibold",children:null==j?void 0:j.customerEmail})]}),j&&(0,t.jsx)("div",{className:"bg-gray-50 rounded-lg p-6 mb-6 text-left",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(l.E,{className:"text-gray-600",children:"N\xfamero de orden:"}),(0,t.jsx)(l.E,{className:"font-semibold",children:j.orderNumber})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(l.E,{className:"text-gray-600",children:"Total pagado:"}),(0,t.jsx)(l.E,{className:"font-semibold text-primary-600",children:(e=j.total,new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(e))})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(l.E,{className:"text-gray-600",children:"Estado:"}),(0,t.jsx)(l.E,{className:"font-semibold text-green-600",children:"Pagado"})]})]})}),(0,t.jsx)("div",{className:"bg-primary-50 rounded-lg p-4 mb-6",children:(0,t.jsx)(l.E,{className:"text-sm text-gray-700",children:"\uD83D\uDCE6 Tu pedido ser\xe1 preparado y enviado a la direcci\xf3n proporcionada. Te notificaremos cuando sea enviado."})}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[(0,t.jsx)(p(),{href:"/productos",children:(0,t.jsxs)(d.$,{children:[(0,t.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Continuar comprando"]})}),(0,t.jsx)(p(),{href:"/",children:(0,t.jsx)(d.$,{variant:"ghost",children:"Volver al inicio"})})]})]})})})})})}function j(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)(c.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-600 mx-auto mb-6"}),(0,t.jsx)(i.D,{level:1,className:"mb-4",children:"Cargando..."})]})})})}),children:(0,t.jsx)(f,{})})}},7621:(e,r,s)=>{"use strict";s.d(r,{ZN:()=>c,Zx:()=>n,cN:()=>i,customersApi:()=>l});let t=s(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3004";class a{async request(e,r,s){let t="".concat(this.baseUrl).concat(e),a=localStorage.getItem("customer_token");try{let e=await fetch(t,{...r,headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...s,...null==r?void 0:r.headers}});if(!e.ok){let r=await e.json().catch(()=>({message:"Error HTTP: ".concat(e.status," ").concat(e.statusText)})),s=r.message||r.error||"Error HTTP: ".concat(e.status);409===e.status?s=r.message||"Este email ya est\xe1 registrado. Por favor, inicia sesi\xf3n o usa otro email.":401===e.status?s=r.message||"Credenciales inv\xe1lidas. Verifica tu email y contrase\xf1a.":400===e.status?s=r.message||r.error||"Datos inv\xe1lidos. Por favor, verifica la informaci\xf3n ingresada.":404===e.status?s=r.message||"Recurso no encontrado.":e.status>=500&&(s="Error del servidor. Por favor, intenta m\xe1s tarde.");let t=Error(s);throw t.status=e.status,t.error=r,t}return e.json()}catch(e){if(e instanceof Error)throw e;throw Error("Error de red al conectar con el servidor")}}async get(e,r){return this.request(e,{method:"GET"},r)}async post(e,r,s){return this.request(e,{method:"POST",body:JSON.stringify(r)},s)}async patch(e,r){return this.request(e,{method:"PATCH",body:JSON.stringify(r)})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e){this.baseUrl=e}}let o=new a(t),c={getAll:()=>o.get("/products?isActive=true"),getFeatured:()=>o.get("/products/featured"),getById:e=>o.get("/products/".concat(e)),getBySlug:e=>o.get("/products/slug/".concat(e)),getByCategory:e=>o.get("/products?categoryId=".concat(e,"&isActive=true"))},n={getAll:()=>o.get("/categories"),getById:e=>o.get("/categories/".concat(e)),getBySlug:e=>o.get("/categories/slug/".concat(e))},i={create:e=>o.post("/orders",e),getMyOrders:()=>{let e=localStorage.getItem("customer_token");return o.get("/orders/my-orders",e?{Authorization:"Bearer ".concat(e)}:{})},getById:e=>o.get("/orders/".concat(e)),getShippingTypes:()=>o.get("/orders/shipping/types"),initiateWebpay:e=>o.post("/orders/".concat(e,"/webpay/init")),confirmWebpay:e=>o.post("/orders/webpay/confirm",{token:e})},l={register:e=>o.post("/customers/register",e),login:e=>o.post("/customers/login",e),getProfile:()=>{let e=localStorage.getItem("customer_token");return o.get("/customers/me",e?{Authorization:"Bearer ".concat(e)}:{})}}}},e=>{e.O(0,[134,690,441,255,358],()=>e(e.s=2624)),_N_E=e.O()}]);