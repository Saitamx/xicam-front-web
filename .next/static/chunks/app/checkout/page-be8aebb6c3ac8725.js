(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279,621],{5015:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>j});var t=r(5155),a=r(2115),o=r(63),i=r(6900),c=r(1165),l=r(5536),n=r(3779),d=r(1171),m=r(8902),u=r(7919),p=r(3405),h=r(5626),g=r(9708),x=r(6398),y=r(8519),b=r(2619),f=r.n(b),N=r(7621);function j(){let{items:e,getTotal:s,clearCart:r}=(0,c._)(),b=(0,l.h)(),{isAuthenticated:j,customer:v}=(0,n.c)();(0,o.useRouter)();let[E,w]=(0,a.useState)(!1),[k,A]=(0,a.useState)([]),[P,T]=(0,a.useState)(null),[C,S]=(0,a.useState)({customerName:"",customerEmail:"",customerPhone:"",shippingAddress:"",notes:""}),[q,B]=(0,a.useState)(!1),I=e=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(e);(0,a.useEffect)(()=>{N.cN.getShippingTypes().then(e=>{A(e),e.length>0&&T(e[0])}).catch(e=>{console.error("Error al cargar tipos de env\xedo:",e)})},[]),(0,a.useEffect)(()=>{if(j&&v&&!q){let e=v.address||"";if(v.city||v.region){let s=[v.address,v.city,v.region].filter(Boolean);s.length>0&&(e=s.join(", "))}S({customerName:v.fullName||"",customerEmail:v.email||"",customerPhone:v.phone||"",shippingAddress:e,notes:""}),B(!0)}else!j&&q&&(S({customerName:"",customerEmail:"",customerPhone:"",shippingAddress:"",notes:""}),B(!1))},[j,v,q]);let _=s(),D=(null==P?void 0:P.price)||0,L=async s=>{s.preventDefault(),w(!0);try{let s=await N.cN.create({customerName:C.customerName,customerEmail:C.customerEmail,customerPhone:C.customerPhone,shippingAddress:C.shippingAddress,shippingType:null==P?void 0:P.type,notes:C.notes,items:e.map(e=>({productId:e.product.id,quantity:e.quantity,isEmbroidered:e.isEmbroidered,embroideryName:e.embroideryName})),paymentMethod:"webpay"}),r=await N.cN.initiateWebpay(s.id);if(r.url)window.location.href=r.url;else throw Error("No se recibi\xf3 URL de Webpay")}catch(e){console.error("Error al procesar orden:",e),b.showError(e.message||"Error al procesar la orden. Por favor, intenta nuevamente."),w(!1)}};return 0===e.length?(0,t.jsx)(i.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12 sm:py-16",children:(0,t.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto text-center",children:[(0,t.jsx)(d.D,{level:1,className:"mb-4",children:"Tu carrito est\xe1 vac\xedo"}),(0,t.jsx)(m.E,{className:"text-gray-600 mb-8",children:"Agrega productos antes de proceder al pago"}),(0,t.jsx)(f(),{href:"/productos",children:(0,t.jsx)(u.$,{children:"Ver Productos"})})]})})})}):(0,t.jsx)(i.U,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-6 sm:py-8",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 sm:px-6",children:[(0,t.jsx)(f(),{href:"/cart",children:(0,t.jsxs)(u.$,{variant:"ghost",size:"sm",className:"mb-6",children:[(0,t.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"Volver al carrito"]})}),(0,t.jsx)(d.D,{level:1,className:"mb-6 sm:mb-8",children:"Checkout"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(p.Z,{className:"p-6 sm:p-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.A,{className:"w-5 h-5 text-primary-600"}),(0,t.jsx)(d.D,{level:2,className:"text-xl",children:"Informaci\xf3n de contacto"})]}),j&&v&&(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-primary-50 text-primary-700 rounded-lg text-sm",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:"Usando datos de tu cuenta"})]})]}),(0,t.jsxs)("form",{onSubmit:L,className:"space-y-4 sm:space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"customerName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre completo *"}),(0,t.jsx)("input",{type:"text",id:"customerName",required:!0,value:C.customerName,onChange:e=>S({...C,customerName:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"customerEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),(0,t.jsx)("input",{type:"email",id:"customerEmail",required:!0,value:C.customerEmail,onChange:e=>S({...C,customerEmail:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"customerPhone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tel\xe9fono *"}),(0,t.jsx)("input",{type:"tel",id:"customerPhone",required:!0,value:C.customerPhone,onChange:e=>S({...C,customerPhone:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"shippingAddress",className:"block text-sm font-medium text-gray-700 mb-2",children:"Direcci\xf3n de env\xedo *"}),(0,t.jsx)("textarea",{id:"shippingAddress",required:!0,value:C.shippingAddress,onChange:e=>S({...C,shippingAddress:e.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[(0,t.jsx)(x.A,{className:"w-4 h-4 inline mr-2"}),"Tipo de env\xedo *"]}),(0,t.jsx)("div",{className:"space-y-2",children:k.map(e=>(0,t.jsxs)("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all ".concat((null==P?void 0:P.type)===e.type?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:[(0,t.jsx)("input",{type:"radio",name:"shipping",value:e.type,checked:(null==P?void 0:P.type)===e.type,onChange:()=>T(e),className:"mt-1"}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(m.E,{className:"font-semibold",children:e.name}),(0,t.jsx)(m.E,{className:"text-sm text-gray-600",children:e.description}),(0,t.jsxs)(m.E,{className:"text-xs text-gray-500 mt-1",children:["Tiempo estimado: ",e.estimatedDays," d\xeda",1!==e.estimatedDays?"s":""]})]}),(0,t.jsx)(m.E,{className:"font-bold text-primary-600 ml-4",children:I(e.price)})]})})]},e.type))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas adicionales (opcional)"}),(0,t.jsx)("textarea",{id:"notes",value:C.notes,onChange:e=>S({...C,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Instrucciones especiales para la entrega..."})]}),(0,t.jsx)(u.$,{type:"submit",className:"w-full",disabled:E||!P,children:E?"Procesando...":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.A,{className:"w-5 h-5 mr-2"}),"Proceder al pago"]})})]})]})}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(p.Z,{className:"p-6 sticky top-24",children:[(0,t.jsx)(d.D,{level:2,className:"mb-4",children:"Resumen del pedido"}),(0,t.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,t.jsx)("div",{className:"space-y-2",children:e.map(e=>{let s=e.product.price*e.quantity+(e.isEmbroidered&&e.product.canBeEmbroidered&&e.product.embroideryPrice?e.product.embroideryPrice*e.quantity:0);return(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(m.E,{className:"font-medium",children:[e.product.name," x ",e.quantity]}),e.isEmbroidered&&e.embroideryName&&(0,t.jsxs)(m.E,{className:"text-xs text-accent-600",children:["âœ¨ Bordado: ",e.embroideryName]})]}),(0,t.jsx)(m.E,{className:"font-semibold",children:I(s)})]},"".concat(e.product.id,"-").concat(e.isEmbroidered))})}),(0,t.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,t.jsx)(m.E,{className:"text-gray-600",children:"Subtotal"}),(0,t.jsx)(m.E,{className:"font-semibold",children:I(_)})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,t.jsx)(m.E,{className:"text-gray-600",children:"Env\xedo"}),(0,t.jsx)(m.E,{className:"font-semibold",children:I(D)})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 pt-3 mt-3",children:(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)(m.E,{className:"text-lg font-bold",children:"Total"}),(0,t.jsx)(m.E,{className:"text-lg font-bold text-primary-600",children:I(_+D)})]})})]})]})]})})]})]})})})}},5626:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(5105).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6059:(e,s,r)=>{Promise.resolve().then(r.bind(r,5015))},6398:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(5105).A)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])},7621:(e,s,r)=>{"use strict";r.d(s,{ZN:()=>i,Zx:()=>c,cN:()=>l,customersApi:()=>n});let t=r(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3004";class a{async request(e,s,r){let t="".concat(this.baseUrl).concat(e),a=localStorage.getItem("customer_token");try{let e=await fetch(t,{...s,headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...r,...null==s?void 0:s.headers}});if(!e.ok){let s=await e.json().catch(()=>({message:"Error HTTP: ".concat(e.status," ").concat(e.statusText)})),r=s.message||s.error||"Error HTTP: ".concat(e.status);409===e.status?r=s.message||"Este email ya est\xe1 registrado. Por favor, inicia sesi\xf3n o usa otro email.":401===e.status?r=s.message||"Credenciales inv\xe1lidas. Verifica tu email y contrase\xf1a.":400===e.status?r=s.message||s.error||"Datos inv\xe1lidos. Por favor, verifica la informaci\xf3n ingresada.":404===e.status?r=s.message||"Recurso no encontrado.":e.status>=500&&(r="Error del servidor. Por favor, intenta m\xe1s tarde.");let t=Error(r);throw t.status=e.status,t.error=s,t}return e.json()}catch(e){if(e instanceof Error)throw e;throw Error("Error de red al conectar con el servidor")}}async get(e,s){return this.request(e,{method:"GET"},s)}async post(e,s,r){return this.request(e,{method:"POST",body:JSON.stringify(s)},r)}async patch(e,s){return this.request(e,{method:"PATCH",body:JSON.stringify(s)})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e){this.baseUrl=e}}let o=new a(t),i={getAll:()=>o.get("/products?isActive=true"),getFeatured:()=>o.get("/products/featured"),getById:e=>o.get("/products/".concat(e)),getBySlug:e=>o.get("/products/slug/".concat(e)),getByCategory:e=>o.get("/products?categoryId=".concat(e,"&isActive=true"))},c={getAll:()=>o.get("/categories"),getById:e=>o.get("/categories/".concat(e)),getBySlug:e=>o.get("/categories/slug/".concat(e))},l={create:e=>o.post("/orders",e),getMyOrders:()=>{let e=localStorage.getItem("customer_token");return o.get("/orders/my-orders",e?{Authorization:"Bearer ".concat(e)}:{})},getById:e=>o.get("/orders/".concat(e)),getShippingTypes:()=>o.get("/orders/shipping/types"),initiateWebpay:e=>o.post("/orders/".concat(e,"/webpay/init")),confirmWebpay:e=>o.post("/orders/webpay/confirm",{token:e})},n={register:e=>o.post("/customers/register",e),login:e=>o.post("/customers/login",e),getProfile:()=>{let e=localStorage.getItem("customer_token");return o.get("/customers/me",e?{Authorization:"Bearer ".concat(e)}:{})}}},8519:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(5105).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},9708:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(5105).A)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])}},e=>{e.O(0,[134,690,441,255,358],()=>e(e.s=6059)),_N_E=e.O()}]);