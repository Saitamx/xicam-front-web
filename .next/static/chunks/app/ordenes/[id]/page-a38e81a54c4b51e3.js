(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621,645],{53:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>E});var r=t(5155),a=t(2115),l=t(63),c=t(6900),i=t(1171),n=t(8902),o=t(7919),d=t(3405),m=t(5626),x=t(508),h=t(3664),g=t(9141),u=t(1873),p=t(2619),y=t.n(p),j=t(7621),N=t(5536),b=t(3779);let f={pending:"bg-yellow-100 text-yellow-800",processing:"bg-blue-100 text-blue-800",paid:"bg-green-100 text-green-800",shipped:"bg-purple-100 text-purple-800",delivered:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800"},v={pending:"Pendiente",processing:"Procesando",paid:"Pagado",shipped:"Enviado",delivered:"Entregado",cancelled:"Cancelado"};function E(){var e;let s=(0,l.useParams)(),t=(0,l.useRouter)(),p=s.id,{isAuthenticated:E}=(0,b.c)(),w=(0,N.h)(),[P,A]=(0,a.useState)(null),[S,C]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!E)return void t.push("/login?return=/ordenes/"+p);T()},[p,E,t]);let T=async()=>{try{C(!0);let e=await j.cN.getById(p);A(e)}catch(e){console.error("Error fetching order:",e),w.showError("Error al cargar la orden"),t.push("/mi-cuenta")}finally{C(!1)}},B=e=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",minimumFractionDigits:0}).format(e);return S?(0,r.jsx)(c.U,{children:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-gray-50 to-white",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):P?(0,r.jsx)(c.U,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-8 sm:py-12",children:(0,r.jsx)("div",{className:"container mx-auto px-4 sm:px-6",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsx)(y(),{href:"/mi-cuenta",children:(0,r.jsxs)(o.$,{variant:"ghost",size:"sm",className:"mb-6",children:[(0,r.jsx)(m.A,{className:"w-4 h-4 mr-2"}),"Volver a Mi Cuenta"]})}),(0,r.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:(0,r.jsxs)("div",{children:[(0,r.jsx)(i.D,{level:1,className:"mb-2",children:P.orderNumber}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(f[P.status]),children:v[P.status]}),"approved"===P.paymentStatus&&(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"Pagado"})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,r.jsxs)(d.Z,{className:"p-6",children:[(0,r.jsx)(i.D,{level:2,className:"mb-4 text-lg",children:"Informaci\xf3n de entrega"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(x.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.E,{className:"text-sm text-gray-600",children:"Nombre"}),(0,r.jsx)(n.E,{className:"font-semibold",children:P.customerName})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(h.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.E,{className:"text-sm text-gray-600",children:"Email"}),(0,r.jsx)(n.E,{className:"font-semibold",children:P.customerEmail})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(g.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.E,{className:"text-sm text-gray-600",children:"Tel\xe9fono"}),(0,r.jsx)(n.E,{className:"font-semibold",children:P.customerPhone})]})]}),P.shippingAddress&&(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(u.A,{className:"w-5 h-5 text-gray-400 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.E,{className:"text-sm text-gray-600",children:"Direcci\xf3n"}),(0,r.jsx)(n.E,{className:"font-semibold",children:P.shippingAddress})]})]})]})]}),(0,r.jsxs)(d.Z,{className:"p-6",children:[(0,r.jsx)(i.D,{level:2,className:"mb-4 text-lg",children:"Resumen de pago"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(n.E,{className:"text-gray-600",children:"Subtotal"}),(0,r.jsx)(n.E,{className:"font-semibold",children:B(P.subtotal)})]}),P.discount>0&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(n.E,{className:"text-gray-600",children:"Descuento"}),(0,r.jsxs)(n.E,{className:"font-semibold text-red-600",children:["-",B(P.discount)]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-2 mt-2",children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(n.E,{className:"font-bold text-lg",children:"Total"}),(0,r.jsx)(n.E,{className:"font-bold text-lg text-primary-600",children:B(P.total)})]})}),(0,r.jsxs)("div",{className:"pt-4 space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(n.E,{className:"text-gray-600",children:"M\xe9todo de pago"}),(0,r.jsx)(n.E,{className:"font-semibold",children:P.paymentMethod})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)(n.E,{className:"text-gray-600",children:"Fecha"}),(0,r.jsx)(n.E,{className:"font-semibold",children:new Date(P.createdAt).toLocaleDateString("es-CL",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]})]})]})]}),(0,r.jsxs)(d.Z,{className:"p-6",children:[(0,r.jsx)(i.D,{level:2,className:"mb-4 text-lg",children:"Productos"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"Producto"}),(0,r.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"Cantidad"}),(0,r.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Precio unitario"}),(0,r.jsx)("th",{className:"text-right py-3 px-4 font-semibold text-gray-700",children:"Subtotal"})]})}),(0,r.jsx)("tbody",{children:null==(e=P.items)?void 0:e.map(e=>(0,r.jsxs)("tr",{className:"border-b border-gray-100",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)(n.E,{className:"font-semibold",children:e.productName}),e.isEmbroidered&&e.embroideryName&&(0,r.jsxs)(n.E,{className:"text-xs text-accent-600",children:["âœ¨ Bordado: ",e.embroideryName]}),e.embroideryPrice&&e.embroideryPrice>0&&(0,r.jsxs)(n.E,{className:"text-xs text-gray-500",children:["+ ",B(e.embroideryPrice)," (bordado)"]})]})}),(0,r.jsx)("td",{className:"text-center py-3 px-4",children:(0,r.jsx)(n.E,{children:e.quantity})}),(0,r.jsx)("td",{className:"text-right py-3 px-4",children:(0,r.jsx)(n.E,{children:B(e.unitPrice)})}),(0,r.jsx)("td",{className:"text-right py-3 px-4",children:(0,r.jsx)(n.E,{className:"font-semibold",children:B(e.subtotal)})})]},e.id))})]})})]})]})})})}):(0,r.jsx)(c.U,{children:(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white py-12",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 text-center",children:[(0,r.jsx)(i.D,{level:2,className:"mb-4",children:"Orden no encontrada"}),(0,r.jsx)(y(),{href:"/mi-cuenta",children:(0,r.jsx)(o.$,{children:"Volver a Mi Cuenta"})})]})})})}},5626:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});let r=(0,t(5105).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7621:(e,s,t)=>{"use strict";t.d(s,{ZN:()=>c,Zx:()=>i,cN:()=>n,customersApi:()=>o});let r=t(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3004";class a{async request(e,s,t){let r="".concat(this.baseUrl).concat(e),a=localStorage.getItem("customer_token");try{let e=await fetch(r,{...s,headers:{"Content-Type":"application/json",...a&&{Authorization:"Bearer ".concat(a)},...t,...null==s?void 0:s.headers}});if(!e.ok){let s=await e.json().catch(()=>({message:"Error HTTP: ".concat(e.status," ").concat(e.statusText)})),t=s.message||s.error||"Error HTTP: ".concat(e.status);409===e.status?t=s.message||"Este email ya est\xe1 registrado. Por favor, inicia sesi\xf3n o usa otro email.":401===e.status?t=s.message||"Credenciales inv\xe1lidas. Verifica tu email y contrase\xf1a.":400===e.status?t=s.message||s.error||"Datos inv\xe1lidos. Por favor, verifica la informaci\xf3n ingresada.":404===e.status?t=s.message||"Recurso no encontrado.":e.status>=500&&(t="Error del servidor. Por favor, intenta m\xe1s tarde.");let r=Error(t);throw r.status=e.status,r.error=s,r}return e.json()}catch(e){if(e instanceof Error)throw e;throw Error("Error de red al conectar con el servidor")}}async get(e,s){return this.request(e,{method:"GET"},s)}async post(e,s,t){return this.request(e,{method:"POST",body:JSON.stringify(s)},t)}async patch(e,s){return this.request(e,{method:"PATCH",body:JSON.stringify(s)})}async delete(e){return this.request(e,{method:"DELETE"})}constructor(e){this.baseUrl=e}}let l=new a(r),c={getAll:()=>l.get("/products?isActive=true"),getFeatured:()=>l.get("/products/featured"),getById:e=>l.get("/products/".concat(e)),getBySlug:e=>l.get("/products/slug/".concat(e)),getByCategory:e=>l.get("/products?categoryId=".concat(e,"&isActive=true"))},i={getAll:()=>l.get("/categories"),getById:e=>l.get("/categories/".concat(e)),getBySlug:e=>l.get("/categories/slug/".concat(e))},n={create:e=>l.post("/orders",e),getMyOrders:()=>{let e=localStorage.getItem("customer_token");return l.get("/orders/my-orders",e?{Authorization:"Bearer ".concat(e)}:{})},getById:e=>l.get("/orders/".concat(e)),getShippingTypes:()=>l.get("/orders/shipping/types"),initiateWebpay:e=>l.post("/orders/".concat(e,"/webpay/init")),confirmWebpay:e=>l.post("/orders/webpay/confirm",{token:e})},o={register:e=>l.post("/customers/register",e),login:e=>l.post("/customers/login",e),getProfile:()=>{let e=localStorage.getItem("customer_token");return l.get("/customers/me",e?{Authorization:"Bearer ".concat(e)}:{})}}},8133:(e,s,t)=>{Promise.resolve().then(t.bind(t,53))}},e=>{e.O(0,[134,690,441,255,358],()=>e(e.s=8133)),_N_E=e.O()}]);